import{o as e}from"./rolldown-runtime-BgAqdD8a.js";import{a as s,r}from"./motion-Q_hw2Ya2.js";import{J as t,N as a,Q as i,X as l,Z as d,_t as n,k as c,st as o,t as m,u as x,ut as h,vt as g,z as p}from"./vendor-D_eNeWdO.js";import"./i18n-PYB7o98L.js";import{c as j,s as f}from"./index-CSH1YS6q.js";var y=e(s(),1),u=e(m(),1),N=r(),b=()=>{const{id:e}=n(),{user:s}=f(),{t:r}=o(),[m,b]=(0,y.useState)(null),[v,w]=(0,y.useState)(!0),[_,A]=(0,y.useState)(null),[D,E]=(0,y.useState)(""),k={},P=e=>{if(!e)return"";const s=e.toLowerCase();return s.startsWith("http")||s.startsWith("data:")||s.startsWith("/")?e:k[`/images/${e}`]||`/images/${e}`};(0,y.useEffect)((()=>{var s;e&&(s=g((function*(){try{const s=`${window.location.origin}/order/${e}`,r=yield u.toDataURL(s,{width:600,margin:2,color:{dark:"#000000",light:"#ffffff"},errorCorrectionLevel:"H"}),t=document.createElement("canvas"),a=t.getContext("2d"),i=new Image,l=new Image;i.src=r,l.src="/logo.png",yield Promise.all([new Promise((e=>i.onload=e)),new Promise((e=>l.onload=e))]),t.width=600,t.height=600,a.drawImage(i,0,0,600,600);const d=150,n=(600-d)/2,c=(600-d)/2;a.fillStyle="#ffffff",a.beginPath(),a.roundRect(n-5,c-5,d+10,d+10,10),a.fill(),a.drawImage(l,n,c,d,d),E(t.toDataURL("image/png"))}catch(s){}})),function(){return s.apply(this,arguments)})()}),[e]);return(0,y.useEffect)((()=>{const r=(t=g((function*(){try{w(!0);const r={headers:{Authorization:`Bearer ${s.token}`}},{data:t}=yield j.get(`/orders/${e}`,r);b(t),w(!1)}catch(r){A(r.response&&r.response.data.message?r.response.data.message:r.message),w(!1)}})),function(){return t.apply(this,arguments)});var t;s&&r()}),[e,s]),v?(0,N.jsx)("div",{className:"min-h-[60vh] flex items-center justify-center text-xl text-primary",children:r("order.loading")}):_?(0,N.jsxs)("div",{className:"min-h-[60vh] flex flex-col items-center justify-center text-center px-4",children:[(0,N.jsx)(d,{className:"w-16 h-16 text-red-500 mb-4"}),(0,N.jsx)("h2",{className:"text-3xl font-serif text-gray-900 mb-4",children:r("order.not_found_title")}),(0,N.jsx)("p",{className:"text-gray-500 mb-8",children:_}),(0,N.jsx)(h,{to:"/",className:"btn btn-primary",children:r("order.go_home")})]}):(0,N.jsxs)("div",{className:"container mx-auto px-4 py-12",children:[(0,N.jsx)("h1",{className:"text-4xl font-serif text-gray-900 mb-10 text-center",children:r("order.title",{id:m._id})}),(0,N.jsx)("div",{className:"max-w-5xl mx-auto card-strong p-8",children:(0,N.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-10",children:[(0,N.jsxs)("div",{className:"lg:col-span-2 space-y-8",children:[(0,N.jsxs)("div",{children:[(0,N.jsxs)("h2",{className:"text-2xl font-serif text-gray-800 mb-4 flex items-center",children:[(0,N.jsx)(p,{className:"mr-3"})," ",r("order.shipping_title")]}),(0,N.jsxs)("div",{className:"card p-5",children:[(0,N.jsxs)("p",{className:"text-gray-700",children:[(0,N.jsxs)("strong",{children:[r("order.name_label"),":"]})," ",m.user.name]}),(0,N.jsxs)("p",{className:"text-gray-700",children:[(0,N.jsxs)("strong",{children:[r("order.email_label"),":"]})," ",(0,N.jsx)("a",{href:`mailto:${m.user.email}`,className:"text-primary hover:underline",children:m.user.email})]}),(0,N.jsxs)("p",{className:"text-gray-700",children:[(0,N.jsxs)("strong",{children:[r("order.address_label"),":"]})," ",m.shippingAddress.address,", ",m.shippingAddress.city,","," ",m.shippingAddress.postalCode,", ",m.shippingAddress.country]}),m.isDelivered?(0,N.jsxs)("div",{className:"mt-3 text-green-600 flex items-center",children:[(0,N.jsx)(i,{className:"mr-2",size:20})," ",r("order.delivered_on",{date:new Date(m.deliveredAt).toLocaleDateString()})]}):(0,N.jsxs)("div",{className:"mt-3 text-red-500 flex items-center",children:[(0,N.jsx)(d,{className:"mr-2",size:20})," ",r("order.not_delivered")]})]})]}),(0,N.jsxs)("div",{children:[(0,N.jsxs)("h2",{className:"text-2xl font-serif text-gray-800 mb-4 flex items-center",children:[(0,N.jsx)(l,{className:"mr-3"})," ",r("order.payment_title")]}),(0,N.jsxs)("div",{className:"card p-5",children:[(0,N.jsxs)("p",{className:"text-gray-700",children:[(0,N.jsxs)("strong",{children:[r("order.method_label"),":"]})," ",m.paymentMethod]}),m.isPaid?(0,N.jsxs)("div",{className:"mt-3 text-green-600 flex items-center",children:[(0,N.jsx)(i,{className:"mr-2",size:20})," ",r("order.paid_on",{date:new Date(m.paidAt).toLocaleDateString()})]}):(0,N.jsxs)("div",{className:"mt-3 text-red-500 flex items-center",children:[(0,N.jsx)(d,{className:"mr-2",size:20})," ",r("order.not_paid")]})]})]}),(0,N.jsxs)("div",{children:[(0,N.jsxs)("h2",{className:"text-2xl font-serif text-gray-800 mb-4 flex items-center",children:[(0,N.jsx)(a,{className:"mr-3"})," ",r("order.items_title")]}),(0,N.jsx)("div",{className:"card p-5 space-y-4",children:m.orderItems.map((e=>(0,N.jsxs)("div",{className:"flex items-center justify-between border-b border-gray-100 pb-4 last:border-b-0 last:pb-0",children:[(0,N.jsxs)("div",{className:"flex items-center",children:[(0,N.jsxs)("div",{className:"w-16 h-16 bg-gradient-to-br from-gray-50 to-gray-100 rounded-md flex items-center justify-center shadow-inner mr-4",children:[(0,N.jsx)("img",{src:P(e.image),alt:e.name,className:"w-14 h-14 object-contain transition-all duration-300 hover:scale-105",onError:e=>{e.target.style.display="none",e.target.nextSibling.style.display="flex"}}),(0,N.jsx)(a,{className:"w-8 h-8 text-gray-400 hidden"})]}),(0,N.jsxs)("div",{children:[(0,N.jsx)(h,{to:`/product/${e.product}`,className:"text-lg font-medium text-gray-800 hover:text-primary hover:underline",children:e.name}),(0,N.jsxs)("p",{className:"text-gray-600 text-sm",children:[e.qty," x AED ",(3.67*e.price).toFixed(2)]})]})]}),(0,N.jsxs)("span",{className:"text-lg font-bold text-gray-900",children:["AED ",(e.qty*e.price*3.67).toFixed(2)]})]},e.product)))})]})]}),(0,N.jsx)("div",{className:"lg:col-span-1",children:(0,N.jsxs)("div",{className:"card p-6 sticky top-24",children:[(0,N.jsx)("h2",{className:"text-xl font-serif font-bold text-gray-900 mb-6",children:r("order.summary_title")}),(0,N.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,N.jsxs)("div",{className:"flex justify-between text-gray-600",children:[(0,N.jsx)("span",{children:r("order.summary_items")}),(0,N.jsxs)("span",{children:["AED ",(3.67*(m.itemsPrice||m.orderItems.reduce(((e,s)=>e+s.price*s.qty),0))).toFixed(2)]})]}),(0,N.jsxs)("div",{className:"flex justify-between text-gray-600",children:[(0,N.jsx)("span",{children:r("order.summary_shipping")}),(0,N.jsxs)("span",{children:["AED ",(3.67*(m.shippingPrice||0)).toFixed(2)]})]}),(0,N.jsxs)("div",{className:"flex justify-between text-gray-600",children:[(0,N.jsx)("span",{children:r("order.summary_tax")}),(0,N.jsxs)("span",{children:["AED ",(3.67*(m.taxPrice||0)).toFixed(2)]})]}),(0,N.jsxs)("div",{className:"border-t border-gray-200 pt-4 flex justify-between font-bold text-lg text-gray-900",children:[(0,N.jsx)("span",{children:r("order.summary_total")}),(0,N.jsxs)("span",{children:["AED ",(3.67*(m.totalPrice||0)).toFixed(2)]})]})]}),!m.isPaid&&(0,N.jsx)("div",{className:"mt-6",children:(0,N.jsx)("button",{className:"btn btn-primary w-full",children:r("order.proceed_payment")})}),(0,N.jsxs)("div",{className:"mt-8 pt-8 border-t border-gray-100",children:[(0,N.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,N.jsx)(c,{className:"w-5 h-5 text-primary"}),(0,N.jsx)("h3",{className:"font-bold text-gray-900",children:r("order.ticket_title")})]}),(0,N.jsxs)("div",{className:"bg-gray-50 rounded-2xl p-6 text-center",children:[(0,N.jsx)("div",{className:"bg-white p-3 rounded-xl shadow-sm inline-block mb-4 border border-gray-100 min-w-[140px] min-h-[140px]",children:D?(0,N.jsx)("img",{src:D,alt:"Order QR Code",className:"w-32 h-32"}):(0,N.jsx)("div",{className:"w-32 h-32 bg-gray-100 animate-pulse rounded-lg"})}),(0,N.jsx)("p",{className:"text-xs text-gray-500 mb-4 leading-relaxed px-2",children:r("order.ticket_scan_hint")}),(0,N.jsxs)("button",{onClick:()=>{if(!D)return void x.error(r("order.qr_download_error"));const s=document.createElement("a");s.download=`SariaBeautyy-Order-${e}.png`,s.href=D,s.click(),x.success(r("order.qr_download_success"))},className:"flex items-center justify-center gap-2 w-full py-3 bg-white border border-gray-200 text-gray-700 rounded-xl text-sm font-bold hover:bg-gray-50 transition-colors shadow-sm",children:[(0,N.jsx)(t,{className:"w-4 h-4"}),r("order.ticket_download")]})]})]})]})})]})})]})};export{b as default};